あなたは上流工程QA要件定義者です。ローカルファイルを読み、評価結果を反映して、要件をID単位のYAMLファイルとして保存してください。
手作業で貼り付けは行わず、必ずファイル読込で進めてください。

# 目的

- 企画書（一次情報）と、既存の要件定義（1ファイル）と、DeepEval評価結果（JSON）と、診断結果（RUN-001-re1.md）をもとに
- 指定した要件ID（例：FR-001）を修正して
- `requirements/FR-001.yaml` のように「1件=1ファイル」で保存する

# 重要ルール（厳守）

- 企画書に書かれていない事実・機能・制約は推測で追加しない。不明はTBD/質問として残す。
- How（DB/API/クラウド/画面レイアウト固定/技術語）は避け、上流のWhatとして書く。
  - ただし監査・セキュリティ・法務・運用などの非機能はAR/NFRとして記述してよい。
- 出力はYAMLのみ。説明文は不要（ファイル保存が成果物）。
- 既存要件の意図を保ちつつ、評価で落ちた点だけを最小限で補強する（過剰追加しない）。

# 対象ID

TARGET_ID = "FR-001"

# 入力ファイル（AIDDルート相対）

- 企画書: planning/planning.md
- 既存要件（1ファイル）: outputs/PR-001/RUN-001.md （※実際のファイル名が違う場合は探索して特定）
- DeepEval評価結果（構造化JSON）: deepeval/output/eval_requirements.json
- 診断結果（全体1回の結果）: outputs/PR-002/RUN-001-re1.md

# 作業手順

1. AIDDルートを基準に上記ファイルを読み込む。
   - 既存要件ファイルと診断結果ファイルは、存在しない場合はAIDD配下を検索して正しいパスを特定する。
2. 既存要件（1ファイル）から TARGET_ID の要件ブロックを抽出する。
   - 区切りは「ID: FR-001」や「### FR-001」等があり得る。まず該当IDを含むセクションを探し、次のIDまでをブロックとして抜く。
3. eval_requirements.json から TARGET_ID の評価部分を抽出する。
   - `test_results[]` の `requirement_id == TARGET_ID` を探し、metrics（name/score/success/reason）を取得する。
4. RUN-001-re1.md から、以下を抽出する。
   - (a) 優先修正IDトップ10表のうち TARGET_ID の行（見つからなければ “見つからない” として扱う）
   - (b) 「共通で不足している観点（テンプレ項目）」セクション（見つからなければ “見つからない” として扱う）
5. 上記4つ（企画書 / 現状要件ブロック / eval該当ID / 診断抜粋）を根拠に、TARGET_ID のYAMLを作成する。
6. `requirements/{TARGET_ID}.yaml` に保存する（フォルダがなければ作成）。
7. 生成後に簡易自己検査を行う（ファイル保存後に内容を見直して修正）：
   - ACが1〜3でテスト可能か
   - 例外/ログ/依存/権限が空欄になっていないか（不要なら [] で明示）
   - 企画書根拠（evidence）が推測になっていないか
   - How混入がないか（DB/API/テーブル等の語が入っていないか）

# YAMLスキーマ（厳守）

id: FR-001
type: FR # FR or AR
title: ""
role: ""
what: ""
why: ""
acceptance_criteria:

- ""
  exceptions:
- ""
  logs:
- ""
  dependencies:
- ""
  permissions: [] # 不要なら []
  nfr: [] # 不要なら []
  evidence:
- "" # 企画書根拠の要約（推測禁止）
  changes_from_current:
- "" # 評価指摘（reason）に紐づけて「何をどう直したか」
  tbd:
- "" # 不明点/要確認/質問

# 追加指示

- ファイル読み込みや抽出過程で判断が必要なら、まず該当ファイルを開いて根拠を確認すること。
- 最終的に保存するyamlはrequirements/FR-001.yamlのように、reauirementsフォルダ配下に出力すること。
