id: FR-007
type: FR
title: Abortを正式な品質判断として扱う
role: 利用者（詳細TBD）
what: タスクがAbortとなった場合、その事実と理由を品質履歴（判断ログ）に含め、後から参照できること。
why: Abortを例外ではなく正式な品質判断として扱い、対象外・前提未確定・スコープ外等の判断根拠を含めて品質履歴として可視化・再利用できるようにするため。
acceptance_criteria:
- Abortとなったタスクが、品質履歴（判断ログ）に含まれること。
- 品質履歴（判断ログ）において、Abortであることが識別でき、Abort理由を参照できること。
- 可視化・保存・エクスポート等の履歴出力において、Abort分岐/結果が含まれること。
exceptions:
- 品質履歴の単位（プロジェクト/スナップショット/期間など）と、出力への包含条件の詳細はTBD。
- 履歴の保持期間、削除可否の扱いはTBD（監査要件次第）。
logs:
- Abortを品質履歴に含めた事実と、その参照・出力に関する操作の事実が後から追跡できること（記録粒度はTBD）。
dependencies:
- FR-006（Abort時の理由必須記録）
- FR-009（品質フロー図生成：Abort分岐表示）
- FR-010（スナップショット保存）
- FR-011（JSON形式エクスポート）
- AR-004（エクスポート対象範囲の明確化：スナップショット単位）
permissions:
- 利用者が品質履歴（判断ログ）を参照できること。
nfr: []
evidence:
- 企画書「6. ステータス設計」「Abort設計思想」：Abortも正式な品質判断として扱う旨の記載。
- 企画書「7. 可視化機能」：Abort分岐も表示し、品質履歴を生成する旨の記載。
- 既存要件（outputs/PR-001/RUN-001.md）：FR-007の記載（Abortを履歴に含める、可視化・保存・エクスポートに含める）。
- 診断（outputs/PR-002/RUN-001-re1.md）：FR-007の修正方針（履歴スコープ＝期間/単位、AR-004整合の明確化が不足）。
changes_from_current:
- 既存要件（outputs/PR-001/RUN-001.md）の意図（Abortを品質判断として履歴に含める）を維持した。
- 診断（outputs/PR-002/RUN-001-re1.md）の指摘に基づき、履歴スコープ（単位/期間）や出力包含条件をTBDとして明示し、依存（AR-004等）を追記した。
- DeepEvalで繰り返し指摘された「チェックリスト観点（例外/ログ/証跡、依存、ロール等）の不足」をTBDとして明示し、推測で確定しないよう整理した。
tbd:
- 品質履歴の単位（プロジェクト/スナップショット/期間など）と、可視化・保存・エクスポートへの包含条件。
- 履歴の保持期間、削除可否（監査・運用要件）。
- ロール定義（利用者/管理者/閲覧者等）と、ロールごとの履歴参照・出力の権限範囲。
- 履歴のログ/証跡の最小粒度（例：誰/いつ/どの履歴を参照・出力したか）。
meta:
  run_id: FR-007
  prompt_id: PR-004
  timestamp: 2026-02-14 16:11
  model: gpt-5.2
  output_hash: 830f8b2540a2cf4fca714be61f3004b0ff3e42dde42702b30c4daa837ce19304
